{% extends 'internconnect/main.html' %}
{% load static %}

{% block title %}My Applicantions{% endblock title %}

{% block navbar %}
{% include 'students/studentnav.html' %}
{% endblock navbar %}

{% block styles %}
{{block.super}}
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css"
  integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
<style>
  body {
    background: white;
  }
</style>
<link rel="stylesheet" type="text/css" href="{% static 'css/recdash.css' %}" media="screen">
{% endblock styles %}

{% block content %}
{% include 'accounts/messages.html' %}
<br><br><br>

<h2 class="container">My Applications</h2>
<br>
<select id="statusFilter">
  <option value="all">All</option>
  <option value="accepted">Accepted</option>
  <option value="pending">Pending</option>
  <option value="denied">Denied</option>
</select>

<!-- <table class="container p-3" style="border: 1px solid black;"> -->
<table class="table container" id="applicationTable">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Internship Title</th>
      <th scope="col">Company</th>
      <th scope="col">Start Date</th>
      <th scope="col">End Date</th>
      <th scope="col">Status</th>
    </tr>
  </thead>
  <tbody>
    {% for application in applications %}
    <tr>
      <td>{{ application.internship.title }}</td>
      <td>{{ application.internship.company}}</td>
      <td>{{ application.internship.start_date }}</td>
      <td>{{ application.internship.end_date }}</td>
      <td>
        {% if application.status == 'accepted' %}
        <button style="background-color: rgb(70, 133, 70);">Accepted</button>
        {% elif application.status == 'pending' %}
        <button style="background-color: rgb(77, 77, 109); color: white;">Pending </button>
        {% elif application.status == 'denied' %}
        <button style="background-color: red;">Denied</button>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<button onclick="generatePDF()" class="submit" style="margin-left: 90px;">Generate PDF</button>
{% block scripts %}
<script>
  // Function to filter data based on selected status
  function filterDataByStatus(status) {
    // Get table rows
    var rows = document.querySelectorAll('#applicationTable tbody tr');

    // Show/hide rows based on status
    rows.forEach(function (row) {
      var statusCell = row.querySelector('td:last-child').innerText.trim();
      if (status === 'all' || status === statusCell.toLowerCase()) {
        row.style.display = 'table-row';
      } else {
        row.style.display = 'none';
      }
    });
  }

  // Event listener for status filter change
  document.getElementById('statusFilter').addEventListener('change', function () {
    var selectedStatus = this.value;
    filterDataByStatus(selectedStatus);
  });

  // Function to generate PDF report
  function generatePDF() {
    // Get filtered data (visible rows in the table)
    var visibleRows = document.querySelectorAll('#applicationTable tbody tr');

    // Prepare data array
    var data = [];
    visibleRows.forEach(function (row) {
      var rowData = [];
      row.querySelectorAll('td').forEach(function (cell) {
        rowData.push(cell.innerText);
      });
      data.push(rowData);
    });

    // Send data to Django view for PDF generation
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/students/applications/generate_report/', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        // PDF generation successful
        console.log('PDF generated successfully.');
      }
    };
    xhr.send(JSON.stringify(data));
  }
</script>

{% endblock scripts %}
{% endblock %}